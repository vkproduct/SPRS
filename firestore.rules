
rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {

    // Helper function to check if user is admin
    function isAdmin() {
      return request.auth != null && request.auth.token.admin == true;
    }

    // Rules for Vendors Collection
    // Public READ: Anyone can view vendors
    // Admin WRITE: Only admins can add/edit/delete vendors
    match /vendors/{vendorId} {
      allow read: if true;
      allow write: if isAdmin();
    }

    // Rules for Inquiries (Leads) Collection
    // CREATE: Anyone can create an inquiry (public lead form)
    // READ: Only admins can read inquiries (protect user data)
    // UPDATE/DELETE: Only admins
    match /inquiries/{inquiryId} {
      allow create: if request.resource.data.keys().hasAll(['vendorId', 'userName', 'contact'])
                   && request.resource.data.userName is string
                   && request.resource.data.userName.size() > 0;
      
      allow read, update, delete: if isAdmin();
    }
    
    // Default deny
    match /{document=**} {
      allow read, write: if false;
    }
  }
}
